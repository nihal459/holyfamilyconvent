{% extends 'admin/hfcadminbase.html' %}
{% load static %}
{% block content %}

<div class="container-fluid">
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title fw-semibold mb-4">Contact Enquiries</h5>

      <!-- Search -->
      <div class="mb-3">
        <input type="text" id="searchInput" class="form-control" placeholder="Search by name or subject">
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Subject</th>
              <th>Message</th>
              <th>Submitted At</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            {% for msg in page_obj %}
              <tr data-keywords="{{ msg.full_name|lower }} {{ msg.subject|lower }}">
                <td>{{ forloop.counter }}</td>
                <td>{{ msg.full_name }}</td>
                <td>{{ msg.email }}</td>
                <td>{{ msg.subject|linebreaks}}</td>
                <td style="white-space: pre-line;">{{ msg.message|truncatechars:100 }}</td>
                <td>{{ msg.submitted_at|date:"d-m-Y H:i" }}</td>
                <td>
                    <a href="{% url 'delete_messages' msg.pk %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this announcement?');">
                    Delete</a>
  
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7" class="text-center">No enquiries found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if page_obj.has_other_pages %}
        <nav>
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?search={{ search_query }}&page={{ page_obj.previous_page_number }}">Previous</a>
              </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item"><a class="page-link" href="?search={{ search_query }}&page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?search={{ search_query }}&page={{ page_obj.next_page_number }}">Next</a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endif %}
    </div>
  </div>
</div>

<!-- Search Script -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const searchInput = document.getElementById('searchInput');
  const rows = document.querySelectorAll('#tableBody tr');

  searchInput.addEventListener('input', function () {
    const query = this.value.toLowerCase();
    rows.forEach(row => {
      const keywords = row.getAttribute('data-keywords');
      if (keywords.includes(query)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });
});
</script>

{% endblock %}
