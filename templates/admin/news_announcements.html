{% extends 'admin/hfcadminbase.html' %}
{% load static %}
{% block content %}

<div class="container-fluid">
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title fw-semibold mb-4">Add News or Announcement</h5>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
          <label for="title" class="form-label">Title</label>
          <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="mb-3">
          <label for="content" class="form-label">Content</label>
          <textarea class="form-control" id="content" name="content" rows="5" required></textarea>
        </div>
        <div class="mb-3">
          <label for="attachment" class="form-label">Attachment (optional)</label>
          <input type="file" class="form-control" id="attachment" name="attachment">
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="is_published" name="is_published" checked>
          <label class="form-check-label" for="is_published">Publish</label>
        </div>
        <button type="submit" class="btn btn-primary">Add Announcement</button>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title fw-semibold mb-4">All News and Announcements</h5>

      <!-- Search Bar -->
      <div class="mb-3">
        <div class="input-group">
          <input type="text" id="searchInput" class="form-control" placeholder="Search by title">
        </div>
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Published</th>
              <th>Date</th>
              <th>Attachment</th>
              <th>View</th>
              <th>Delete</th>

            </tr>
          </thead>
          <tbody id="tableBody">
            {% for item in page_obj %}
              <tr data-title="{{ item.title|lower }}">
                <td>{{ forloop.counter }}</td>
                <td>{{ item.title }}</td>
                <td>
                  {% if item.is_published %}
                    <span class="badge bg-success">Yes</span>
                  {% else %}
                    <span class="badge bg-secondary">No</span>
                  {% endif %}
                </td>
                <td>{{ item.published_date|date:"d-m-Y" }}</td>
                  
                <td>
                  {% if item.attachment %}
                    <a href="{{ item.attachment.url }}" target="_blank">View Attachment</a>
                  {% else %}
                    N/A
                  {% endif %}
                </td>
                <td><a href="{% url 'news_announcements_detail' item.pk %}" class="btn btn-primary btn-sm">View</a></td>

                <td>
                  <a href="{% url 'delete_news' item.pk %}" class="btn btn-danger btn-sm"
                    onclick="return confirm('Are you sure you want to delete this announcement?');">
                      Delete
                  </a>
                </td>

              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if page_obj.has_other_pages %}
        <nav>
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?search={{ search_query }}&page={{ page_obj.previous_page_number }}">Previous</a>
              </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item"><a class="page-link" href="?search={{ search_query }}&page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?search={{ search_query }}&page={{ page_obj.next_page_number }}">Next</a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endif %}

    </div>
  </div>
</div>

  

<script>
    document.addEventListener('DOMContentLoaded', function () {
      const searchInput = document.getElementById('searchInput');
      const tableRows = document.querySelectorAll('#tableBody tr');
  
      searchInput.addEventListener('input', function () {
        const query = this.value.toLowerCase();
  
        tableRows.forEach(row => {
          const title = row.getAttribute('data-title');
          if (title.includes(query)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    });
</script>

{% endblock %}
